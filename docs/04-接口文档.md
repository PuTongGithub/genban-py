# 对外接口文档

## 基础信息

- **Base URL**: `http://localhost:8000`
- **接口前缀**: `/api`

---

## 1. 获取模型列表

### 接口描述
获取所有可用的 AI 模型名称

### 请求信息

**方法**: `GET`  
**路径**: `/api/get_models`

### 请求示例

```bash
curl -X GET "http://localhost:8000/api/get_models"
```

### 响应示例

```json
["qwen3-14b", "qwen3-32b", "qwen3-max", "qwen-plus", "qwen-turbo"]
```

### 响应字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| - | `string[]` | 模型名称数组 |

---

## 2. 创建新会话

### 接口描述
创建一个新的对话会话，返回会话 ID

### 请求信息

**方法**: `GET`  
**路径**: `/api/new_session`

### 请求示例

```bash
curl -X GET "http://localhost:8000/api/new_session"
```

### 响应示例

```json
1739101234.567
```

### 响应字段说明

| 字段 | 类型 | 说明 |
|------|------|------|
| - | `float` | 会话 ID（时间戳格式） |

---

## 3. 流式对话

### 接口描述
发送消息并流式接收 AI 响应（Server-Sent Events）

### 请求信息

**方法**: `POST`  
**路径**: `/api/talk`  
**Content-Type**: `application/json`

### 请求参数

| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| session_id | `string` | 是 | 会话 ID（通过 `/api/new_session` 获取） |
| user_input | `string` | 是 | 用户输入内容 |
| model | `string` | 是 | 模型名称（从 `/api/get_models` 获取） |

### 请求示例

```bash
curl -X POST "http://localhost:8000/api/talk" \
  -H "Content-Type: application/json" \
  -d '{
    "session_id": "1739101234.567",
    "user_input": "你好，请介绍一下自己",
    "model": "qwen3-32b"
  }'
```

### 响应格式

**Content-Type**: `text/event-stream`

响应采用 SSE (Server-Sent Events) 格式，包含以下三种事件类型：

#### 1. message 事件

流式返回 AI 的回答内容，每次返回全量内容。

**事件格式**:
```
event: message
data: {"role": "assistant", "content": "回答内容", "reasoning_content": "思考过程"}
```

**响应字段说明**:

| 字段                | 类型       | 说明                      |
| ----------------- | -------- | ----------------------- |
| role              | `string` | 消息角色，固定为 `"assistant"`  |
| content           | `string` | AI 的回答内容（全量，每次返回完整内容）   |
| reasoning_content | `string` | AI 的思考过程内容（全量，每次返回完整内容） |

#### 2. complete 事件

当 AI 回答完成时触发，表示流式响应结束。

**事件格式**:
```
event: complete
data: 
```

#### 3. error 事件

当接口发生错误时触发。

**事件格式**:
```
event: error
data: {"error": "错误描述信息"}
```

### 响应示例

```
event: message
data: {"role": "assistant", "content": "", "reasoning_content": "让我"}

event: message
data: {"role": "assistant", "content": "", "reasoning_content": "让我思考"}

event: message
data: {"role": "assistant", "content": "", "reasoning_content": "让我思考一下..."}

event: message
data: {"role": "assistant", "content": "你好", "reasoning_content": "让我思考一下..."}

event: message
data: {"role": "assistant", "content": "你好！", "reasoning_content": "让我思考一下..."}

event: complete
data: 
```

### 注意事项

1. **全量返回**: 每次 `message` 事件返回的 `content` 和 `reasoning_content` 都是**全量内容**，前端直接替换显示即可，无需拼接
2. **sessionId**: 前端需要维护会话 ID，用于多轮对话上下文
3. **模型选择**: 先调用 `/get_models` 获取可用模型列表
4. **错误处理**: 需要监听 `error` 事件处理异常情况
5. **完成标识**: 通过 `complete` 事件判断流式响应结束
